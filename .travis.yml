sudo: required
services: docker

env:
  global:
  # Docker Username
  - secure: "khS3gPc1//qlDXAjmGMRnZDztCuGpbubKxbPHPhZ+/M8rJRicfNsbOdTCwYLU95BVwCxlt4rHnB/+lC9F2s4uz0wz2vr5Motrs3cfE1Iujn1sEsq3ZWivK8QjOL6dfvbfHK21FRPQBV14GQXIyUZa/Z7xTLYMrIUBOTuC1SVJDKYpYqxL0kMkKvcv6MpTvTFR/O8QkkbU9qETvI9tFNARtfNS3wRKHEvHJcQ9TZg+DxGT/wEbpv/OTx0QwT0vzMAah9pc0C7fy3ngYR7vGM9gg0hgFVBwc4TWIP5mWU5c1Ltd4ItVrdkjYlUhYmgNxP0TXfGlvMPM8h83bb4r6vzgsSHrnokOKBCaBBSwHkJ48ViihROe8m25VKRSYlHLQIlG6joLqu7mvyyrxdvblYEatszVdbeb/jeaYiuWPYT8Kx7cWAk/xdEsIRcOB+RxP9W1HfbKUA3VCvYs0T94dnJqrBKlBAWD3R0arvNWCuCruFZSYjGUK2HZME9rKAAt71aHybSAXmiiyEkgtkU0NJiCLh+7E+yyjN2jY3+seEaV3+TNJ+giSfJ0ykn4CRyZ7VqFtHcxbnqknDNDoXfff0OnoZxHFxRApUn/xsqlbFpSF8z5V/2APmltbqiTu0oyzJeI9/KfgX+dJISwb78rd4haNmEgz26wLmz9jU9KaGt9Vk="
  # Docker Password
  - secure: "wNg+wZNIFwFkG6iFrrplyx0UjzG4uc/OD+pzWxLqyye/Xc3mNZkdgsLtxmollR1/ppzcguOcamjux5uAHXECSrBstqlMAXuf6diR1Z9LSfLL3K5vwLRNEKeryGq/5LkLZoNLPs4OFEEzbFOofP5Coq9ER1qv9T7FD5w3TAhpnjj1XCQm1hhMZAdRwX0U4pDBFQ8DhhzHkCIZkgmog8ibTxCHM7ltLGngFw0Jwn02cL2Ro6yIERr/8deXJ5uNn+f2IT0g6Qx+Y/IqFfaHIhUg7p+48WWR5SVgYWeBq25iz46yRfMWPi6ujN0Nk7bH5dWjwe/Q6lwc3rtPBl5HBtksrhtF0sWBSHmEuTDRuyax0/EMUkk2oIhQPeg6GyZhWINyfildCyd2MIju4KI7KtByC5RlFhKtNaHxvvjeiCypcRk9MHvmxP5Gq+ctJt2uKv3k9Sc/TRY6M92EJ27fBPoRjNeifksUKP0FcVnjwGXegux4ORA7rkCQ0lEWNaUvKAHJvWBI/waHJHaTzM7MvGQmbOXeGkYpUtjQLCIs5xmfRpfCa0/V/Xi4tKIwqFnvbk9nR3J5q+HOdSlZXPrR4yt77eI18Jn1EIt7lIFoZcnwuGVSTGLP5rvqjnXPY3v8W3LPD0Yz+zVQdoiXUybrZLOZiG8xNyTlZSYhdjem6JP7jVw="
  matrix:
  - VERSION=2.4.88 BASE=ubuntu
  - VERSION=2.4.89 BASE=ubuntu

before_install:
- './.travis/main.sh'

script:
- travis_retry make build-travis v=${VERSION} b=${BASE}
- travis_retry make tags-travis v=${VERSION} b=${BASE}

after_script:
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
# check if branch=master and the current build is no pull request, then push it to docker hub
- if [[ "$TRAVIS_BRANCH" == "master" ]]; then 
    if [[ "$TRAVIS_PULL_REQUEST" == "false" ]]; then 
      make push-image LOCATION=public; 
    fi; 
  fi
# check if branch=develop and the current build is no pull request, then push it to docker hub
- if [[ "$TRAVIS_BRANCH" == "develop" ]]; then 
    if [[ "$TRAVIS_PULL_REQUEST" == "false" ]]; then 
      make push-image LOCATION=private; 
    fi; 
  fi

# don't notify me when things fail
notifications:
  email: false