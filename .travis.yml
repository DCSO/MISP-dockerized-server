language: minimal
dist: xenial
addons:
  apt:
    sources:
      - docker-xenial

env:
  global:
  #- DOCKER_COMPOSE_VERSION=1.4.2
  - COMPONENT=server
  matrix:
  # Activate only Supported and Nightly Images.
  - VERSION=2.4.nightly FOLDER=$VERSION-ubuntu
  - VERSION=2.4.nightly FOLDER=$VERSION-debian
  - VERSION=2.4.88 FOLDER=$VERSION-ubuntu
  - VERSION=2.4.89 FOLDER=$VERSION-ubuntu
  - VERSION=2.4.90 FOLDER=$VERSION-ubuntu
  - VERSION=2.4.91 FOLDER=$VERSION-ubuntu
  - VERSION=2.4.92 FOLDER=$VERSION-ubuntu
  - VERSION=2.4.93 FOLDER=$VERSION-ubuntu
  - VERSION=2.4.94 FOLDER=$VERSION-ubuntu
  - VERSION=2.4.95 FOLDER=$VERSION-ubuntu
  - VERSION=2.4.96 FOLDER=$VERSION-ubuntu
  - VERSION=2.4.97 FOLDER=$VERSION-debian
  - VERSION=2.4.98 FOLDER=$VERSION-debian
  - VERSION=2.4.99 FOLDER=$VERSION-debian
  - VERSION=2.4.100 FOLDER=$VERSION-debian
  - VERSION=2.4.101 FOLDER=$VERSION-debian
  - VERSION=2.4.102 FOLDER=$VERSION-debian
  - VERSION=2.4.103 FOLDER=$VERSION-debian
  - VERSION=2.4.104 FOLDER=$VERSION-debian
  - VERSION=2.4.105 FOLDER=$VERSION-debian
  - VERSION=2.4.106 FOLDER=$VERSION-debian
  - VERSION=2.4.107 FOLDER=$VERSION-debian
  - VERSION=2.4.108 FOLDER=$VERSION-debian
  - VERSION=2.4.109 FOLDER=$VERSION-debian
  - VERSION=2.4.110 FOLDER=$VERSION-debian


script:
- docker build -f "$FOLDER/Dockerfile" 
                      --build-arg VCS_REF="$TRAVIS_COMMIT" 
                      --build-arg VERSION="$VERSION" 
                      --build-arg GIT_REPO="https://github.com/$TRAVIS_REPO_SLUG" 
                      --build-arg COMPONENT="$COMPONENT"
                      --build-arg BUILD_DATE="$(date -u +"%Y-%m-%d")"
                      "$FOLDER"


# # don't notify me when things fail
# notifications:
#   email: false
