sudo: required
services: docker

env:
  global:
  # Docker Username
  - secure: "khS3gPc1//qlDXAjmGMRnZDztCuGpbubKxbPHPhZ+/M8rJRicfNsbOdTCwYLU95BVwCxlt4rHnB/+lC9F2s4uz0wz2vr5Motrs3cfE1Iujn1sEsq3ZWivK8QjOL6dfvbfHK21FRPQBV14GQXIyUZa/Z7xTLYMrIUBOTuC1SVJDKYpYqxL0kMkKvcv6MpTvTFR/O8QkkbU9qETvI9tFNARtfNS3wRKHEvHJcQ9TZg+DxGT/wEbpv/OTx0QwT0vzMAah9pc0C7fy3ngYR7vGM9gg0hgFVBwc4TWIP5mWU5c1Ltd4ItVrdkjYlUhYmgNxP0TXfGlvMPM8h83bb4r6vzgsSHrnokOKBCaBBSwHkJ48ViihROe8m25VKRSYlHLQIlG6joLqu7mvyyrxdvblYEatszVdbeb/jeaYiuWPYT8Kx7cWAk/xdEsIRcOB+RxP9W1HfbKUA3VCvYs0T94dnJqrBKlBAWD3R0arvNWCuCruFZSYjGUK2HZME9rKAAt71aHybSAXmiiyEkgtkU0NJiCLh+7E+yyjN2jY3+seEaV3+TNJ+giSfJ0ykn4CRyZ7VqFtHcxbnqknDNDoXfff0OnoZxHFxRApUn/xsqlbFpSF8z5V/2APmltbqiTu0oyzJeI9/KfgX+dJISwb78rd4haNmEgz26wLmz9jU9KaGt9Vk="
  # Docker Password
  - secure: "wNg+wZNIFwFkG6iFrrplyx0UjzG4uc/OD+pzWxLqyye/Xc3mNZkdgsLtxmollR1/ppzcguOcamjux5uAHXECSrBstqlMAXuf6diR1Z9LSfLL3K5vwLRNEKeryGq/5LkLZoNLPs4OFEEzbFOofP5Coq9ER1qv9T7FD5w3TAhpnjj1XCQm1hhMZAdRwX0U4pDBFQ8DhhzHkCIZkgmog8ibTxCHM7ltLGngFw0Jwn02cL2Ro6yIERr/8deXJ5uNn+f2IT0g6Qx+Y/IqFfaHIhUg7p+48WWR5SVgYWeBq25iz46yRfMWPi6ujN0Nk7bH5dWjwe/Q6lwc3rtPBl5HBtksrhtF0sWBSHmEuTDRuyax0/EMUkk2oIhQPeg6GyZhWINyfildCyd2MIju4KI7KtByC5RlFhKtNaHxvvjeiCypcRk9MHvmxP5Gq+ctJt2uKv3k9Sc/TRY6M92EJ27fBPoRjNeifksUKP0FcVnjwGXegux4ORA7rkCQ0lEWNaUvKAHJvWBI/waHJHaTzM7MvGQmbOXeGkYpUtjQLCIs5xmfRpfCa0/V/Xi4tKIwqFnvbk9nR3J5q+HOdSlZXPrR4yt77eI18Jn1EIt7lIFoZcnwuGVSTGLP5rvqjnXPY3v8W3LPD0Yz+zVQdoiXUybrZLOZiG8xNyTlZSYhdjem6JP7jVw="
  # Docker Hub Token
  - secure: "aJ1I2CaABPgMtrkn2mm8sIbgnXMXa9rSKIVDAWds07U/od5GVzCSBgFZhmYcfkZjxrrs75ArRXhhAEEZHfONeuxsz3S8vCksw+6jh13zWpTPtFOkWEPczhkuxH5K8iY1Fp1AnOVZMSSpkmqNUB2+dNLgvfOpw2pb9y43W4G11GFpdVH0nrwGQeTOfPNsIe24tgR2LrQWCElAjJZgZieB5ptQlIyfKh9fD8MfR0WWL68MBCJZcZagt5oE4BMt0liZEu6ARNdsAW4to0bbuvsfoBcYwztqgMWvoSEWJQkGjpzPUKqMxSqqyEQHr0CVj4yzKpxYufsRtamDJxte86pSV20pNMzgY3iIriXlApDvdEI1kwm55fI2GXLTiuErLpCdwqtreS1ygtuSnYNJ4uYiKHM0OXLfS/ta/hPVScMCStt/ttGolrwumsIpAOOLR0RoMbbV1PjLwxXStomePMsa7bTt2ruCkV3yK2nArRDK5lluENbU8L4x4LPtoOGGlT3J6gPV+ZOdUf676aZVAVZDum20Oq35xvFCqiATn9StytZo0aGXqGHmGNuqz+FUHv4sQ5qN+7SWKUxokQ7A4/gM3lX1pYgDE6D1lgUs9/pOxUxCxCCvsFqU4n2pkcYj0wThy7AcQiFcZf7Z63y2bnQCWAQADEpzPH5mVuPiRDxBx5U="
  matrix:
  - VERSION=2.4.88-ubuntu
  - VERSION=2.4.89-ubuntu
  - VERSION=2.4.90-ubuntu
  - VERSION=2.4.91-ubuntu
  - VERSION=2.4.92-ubuntu
  - VERSION=2.4.93-ubuntu
  - VERSION=2.4.94-ubuntu
  - VERSION=2.4.95-ubuntu
  - VERSION=2.4.96-ubuntu

before_install:
- make install

script:
- travis_retry make build v=${VERSION} dev=dev
- make tags

after_script:
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
# check if branch=master and the current build is no pull request, then push it to docker hub
#- [[ "$TRAVIS_BRANCH" == "master" ]] && [[ "$TRAVIS_PULL_REQUEST" == "false" ]] && make push;
- if [[ "$TRAVIS_BRANCH" == "master" ]]; then 
    if [[ "$TRAVIS_PULL_REQUEST" == "false" ]]; then 
      make push;
    fi; 
  fi

after_success:
# notify Docker Hub to make a new build
#- [[ "$TRAVIS_BRANCH" == "master" ]] && [[ "$TRAVIS_PULL_REQUEST" == "false" ]] && make notify-hub-docker-com TOKEN=$DOCKER_HUB_TOKEN
- if [[ "$TRAVIS_BRANCH" == "master" ]]; then 
    if [[ "$TRAVIS_PULL_REQUEST" == "false" ]]; then 
      make notify-hub-docker-com TOKEN=$DOCKER_HUB_TOKEN

    fi; 
  fi

# don't notify me when things fail
notifications:
  email: false