dist: xenial
addons:
  apt:
    sources:
      - docker-xenial

env:
  global:
  # Docker Username
  - secure: "khS3gPc1//qlDXAjmGMRnZDztCuGpbubKxbPHPhZ+/M8rJRicfNsbOdTCwYLU95BVwCxlt4rHnB/+lC9F2s4uz0wz2vr5Motrs3cfE1Iujn1sEsq3ZWivK8QjOL6dfvbfHK21FRPQBV14GQXIyUZa/Z7xTLYMrIUBOTuC1SVJDKYpYqxL0kMkKvcv6MpTvTFR/O8QkkbU9qETvI9tFNARtfNS3wRKHEvHJcQ9TZg+DxGT/wEbpv/OTx0QwT0vzMAah9pc0C7fy3ngYR7vGM9gg0hgFVBwc4TWIP5mWU5c1Ltd4ItVrdkjYlUhYmgNxP0TXfGlvMPM8h83bb4r6vzgsSHrnokOKBCaBBSwHkJ48ViihROe8m25VKRSYlHLQIlG6joLqu7mvyyrxdvblYEatszVdbeb/jeaYiuWPYT8Kx7cWAk/xdEsIRcOB+RxP9W1HfbKUA3VCvYs0T94dnJqrBKlBAWD3R0arvNWCuCruFZSYjGUK2HZME9rKAAt71aHybSAXmiiyEkgtkU0NJiCLh+7E+yyjN2jY3+seEaV3+TNJ+giSfJ0ykn4CRyZ7VqFtHcxbnqknDNDoXfff0OnoZxHFxRApUn/xsqlbFpSF8z5V/2APmltbqiTu0oyzJeI9/KfgX+dJISwb78rd4haNmEgz26wLmz9jU9KaGt9Vk="
  # Docker Password
  - secure: "wNg+wZNIFwFkG6iFrrplyx0UjzG4uc/OD+pzWxLqyye/Xc3mNZkdgsLtxmollR1/ppzcguOcamjux5uAHXECSrBstqlMAXuf6diR1Z9LSfLL3K5vwLRNEKeryGq/5LkLZoNLPs4OFEEzbFOofP5Coq9ER1qv9T7FD5w3TAhpnjj1XCQm1hhMZAdRwX0U4pDBFQ8DhhzHkCIZkgmog8ibTxCHM7ltLGngFw0Jwn02cL2Ro6yIERr/8deXJ5uNn+f2IT0g6Qx+Y/IqFfaHIhUg7p+48WWR5SVgYWeBq25iz46yRfMWPi6ujN0Nk7bH5dWjwe/Q6lwc3rtPBl5HBtksrhtF0sWBSHmEuTDRuyax0/EMUkk2oIhQPeg6GyZhWINyfildCyd2MIju4KI7KtByC5RlFhKtNaHxvvjeiCypcRk9MHvmxP5Gq+ctJt2uKv3k9Sc/TRY6M92EJ27fBPoRjNeifksUKP0FcVnjwGXegux4ORA7rkCQ0lEWNaUvKAHJvWBI/waHJHaTzM7MvGQmbOXeGkYpUtjQLCIs5xmfRpfCa0/V/Xi4tKIwqFnvbk9nR3J5q+HOdSlZXPrR4yt77eI18Jn1EIt7lIFoZcnwuGVSTGLP5rvqjnXPY3v8W3LPD0Yz+zVQdoiXUybrZLOZiG8xNyTlZSYhdjem6JP7jVw="
  # Docker Hub Token
  - secure: "aJ1I2CaABPgMtrkn2mm8sIbgnXMXa9rSKIVDAWds07U/od5GVzCSBgFZhmYcfkZjxrrs75ArRXhhAEEZHfONeuxsz3S8vCksw+6jh13zWpTPtFOkWEPczhkuxH5K8iY1Fp1AnOVZMSSpkmqNUB2+dNLgvfOpw2pb9y43W4G11GFpdVH0nrwGQeTOfPNsIe24tgR2LrQWCElAjJZgZieB5ptQlIyfKh9fD8MfR0WWL68MBCJZcZagt5oE4BMt0liZEu6ARNdsAW4to0bbuvsfoBcYwztqgMWvoSEWJQkGjpzPUKqMxSqqyEQHr0CVj4yzKpxYufsRtamDJxte86pSV20pNMzgY3iIriXlApDvdEI1kwm55fI2GXLTiuErLpCdwqtreS1ygtuSnYNJ4uYiKHM0OXLfS/ta/hPVScMCStt/ttGolrwumsIpAOOLR0RoMbbV1PjLwxXStomePMsa7bTt2ruCkV3yK2nArRDK5lluENbU8L4x4LPtoOGGlT3J6gPV+ZOdUf676aZVAVZDum20Oq35xvFCqiATn9StytZo0aGXqGHmGNuqz+FUHv4sQ5qN+7SWKUxokQ7A4/gM3lX1pYgDE6D1lgUs9/pOxUxCxCCvsFqU4n2pkcYj0wThy7AcQiFcZf7Z63y2bnQCWAQADEpzPH5mVuPiRDxBx5U="
  # The following variables are setup via gitlab project group:
  # - DOCKER_HUB_TOKEN
  # - DOCKER_SLUG
  # - DOCKER_USERNAME
  # - DOCKER_PASSWORD
  # - CUSTOM_REGISTRY_URL
  # - CUSTOM_REGISTRY_USER
  # - CUSTOM_REGISTRY_PW
  matrix:
  - VERSION=2.4.88-ubuntu
  - VERSION=2.4.89-ubuntu
  - VERSION=2.4.90-ubuntu
  - VERSION=2.4.91-ubuntu
  - VERSION=2.4.92-ubuntu
  - VERSION=2.4.93-ubuntu
  - VERSION=2.4.94-ubuntu
  - VERSION=2.4.95-ubuntu
  - VERSION=2.4.96-ubuntu
  - VERSION=2.4.97-debian
  - VERSION=2.4.98-debian
  - VERSION=2.4.99-debian
  - VERSION=2.4.100-debian
  - VERSION=2.4.101-debian
  - VERSION=2.4.nightly-ubuntu
  
#
# Install dependencies
#
before_install:
- sudo .ci/01_before_install.sh

#
# Build and tag our image
#
script:
- make -C .ci build v=${VERSION} prod=false      # Set prod=true, if you want to build NO '-dev' tag
- make -C .ci tags REPO=$DOCKER_SLUG prod=false  # Set prod=true, if you want tags NO '-dev' tag

#
# Push all Images found with the current Docker container name to the Docker registries
#
# deploy:
#   provider: script
#   script: 
#   - make -C .ci push REPO=$DOCKER_SLUG USER=$DOCKER_USERNAME PW=$DOCKER_PASSWORD
#   on:
#     branch: master

#
# Trigger hub.docker.com automatic_build queue to update Readme
#
after_success:
# [OPTIONAL] Notify Docker hub about a new Readme and update the content 
#- if [[ "$TRAVIS_BRANCH" == "master" ]]; then make -C .ci notify-hub-docker-com TOKEN=$DOCKER_HUB_TOKEN;  fi; 

notifications:
  # don't notify me when things fail
  email: false